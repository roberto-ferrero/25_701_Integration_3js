<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pandora Map</title>
    <link rel="stylesheet" href="./assets/map3d/style.css"> 
</head>
<body>

    <div id="webgl_app" style="width: 100%; height: 100vh;"></div>
    <div id="tooltip" style="
            position: fixed; 
            pointer-events: none; 
            display: none; 
            background: rgba(0, 0, 0, 0.8); 
            color: white; 
            padding: 8px 12px; 
            border-radius: 4px; 
            font-family: Arial, sans-serif; 
            font-size: 12px; 
            z-index: 1000;
        ">
    </div>


    <script src="./assets/map3d/bundle.js"></script>

    <script>
        // Esperar a que el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Window loaded, initializing PandoraMap...");
            // "PandoraMap" es el nombre que definimos en webpack.output.library.name
            if (window.PandoraMap) {
                window.PandoraMap.init({
                    $container: document.querySelector('#webgl_app'),
                    $mouseEvents: document.querySelector('#webgl_app'),
                    loader_pathPrefix: "./assets/map3d/", // Ruta relativa a sus assets si fuera necesario
                    cities_dataPath: "./assets/map3d/data/cities.json",
                    shops_dataPath: "./assets/map3d/data/shops.json",
                    events_dataPath: "./assets/map3d/data/events.json",
                    settings_dataPath: "./assets/map3d/data/settings.json"
                });
                // EVENTOS:
                window.platform.webglApp.emitter.on("onCityClicked", (data) => {
                    console.log("CITY Clicked:", data.id);
                    // Aquí puedes manejar el evento como desees
                })
                window.platform.webglApp.emitter.on("onEventClicked", (data) => {
                    console.log("EVENT Clicked:", data.id);
                    // Aquí puedes manejar el evento como desees
                })
                window.platform.webglApp.emitter.on("onShopClicked", (data) => {
                    console.log("SHOP Clicked:", data.id);
                    // Aquí puedes manejar el evento como desees
                })
                window.platform.webglApp.emitter.on("onAppZoomChange", (data) => {
                    console.log("APP Zoom Changed:", data.zoom);
                    // Se ha cambiado el zoom de la app
                })
                window.platform.webglApp.emitter.on("onAppTierModeChange", (data) => {
                    console.log("APP Tier Mode Changed:", data.tierMode);
                    // Se ha cambiado el modo tier
                })

                // API:
                // Metodos:
                // window.platform.webglApp.stage.get_MODE() // {"IDLE", "ZOOMING", "TRAVELLING", "SELECTING"} Intentar usar comandos del API con "IDLE" 
                // window.platform.webglApp.stage.get_ZOOM() // Obtiene el nivel de zoom actual
                // window.platform.webglApp.stage.get_TIER_LEVEL() // Obtiene el modo actual (modo tier)
                // window.platform.webglApp.stage.zoomIn() // Aumenta el zoom
                // window.platform.webglApp.stage.zoomOut() // Disminuye el zoom
                // window.platform.webglApp.stage.zoomToLevel(newZoomLevel) // Establece el zoom a un nivel específico
                // window.platform.webglApp.stage.selectMarker(markerId, typeId, newZoomLevel) // Mueve la camara a una ciudad/evento/tienda y establece el zoom y aplica el offset correspondiente
                // window.platform.webglApp.stage.resetOffset() // Deja de aplicar offset
                // window.platform.webglApp.stage.applyOffset() // Aplica offset
            } else {
                console.error("La librería PandoraMap no se cargó correctamente.");
            }

        });
    </script>
</body>
</html>